Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/focal64"
config.vm.hostname = "apache"
config.vm.network "private_network", ip: "192.168.50.4"
config.vm.provider "virtualbox" do |vb|
  vb.name = "Apache in Docker"
  vb.customize ["modifyvm", :id, "--cpus", "4"]
  vb.customize ["modifyvm", :id, "--memory", "4000"]
  vb.customize ["modifyvm", :id, "--usb", "off"]
  vb.customize ["modifyvm", :id, "--usbehci", "off"]
end
config.vm.provision "shell", inline: <<-SHELL
  sudo apt update -y
  sudo apt upgrade -y
  sudo apt autoremove -y
  sudo apt install docker docker-compose -y

  sudo systemctl enable docker
  sudo systemctl start docker
  
  
  sudo apt install ufw -y
  sudo apt install net-tools -y    
  sudo ufw enable
  sudo ufw allow 9443
  sudo ufw allow 22
  
  sudo docker volume create portainer_data
  sudo docker run -d -p 8000:8000 -p 9443:9443 --name portainer \
  --restart=always \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v portainer_data:/data \
  portainer/portainer-ce:2.9.3

 sudo apt autoremove -y
 sudo apt autoclean -y
SHELL
end